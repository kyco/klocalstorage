/*
**
**  klocalstorage
**  =============
**
**  Version 1.0.2
**
**  Brought to you by
**  https://www.kycosoftware.com
**
**  Copyright 2015 Cornelius Weidmann
**
**  Distributed under the GPL
**
*/

"use strict";var klocalstorage={}||klocalstorage;klocalstorage.JQUERY_URL="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js";klocalstorage.JSONEDITOR_URL="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/4.2.1/jsoneditor.min.js";klocalstorage.JSONEDITOR_STYLE_URL="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/4.2.1/jsoneditor.min.css";klocalstorage.STYLE=document.getElementById("klocalstorage_style");klocalstorage.SCRIPT=document.getElementById("klocalstorage_script");klocalstorage.ERROR_MSG="An error occurred while getting the required dependencies.";klocalstorage.editor={};klocalstorage.init=function(){var e='<style>.klocalstorage_activated{height:100%;overflow:hidden}#klocalstorage_overlay{position:fixed;z-index:99998;background-color:rgba(0,0,0,0.25);top:0;left:0;width:100%;height:100%;display:none}#klocalstorage_overlay.active{display:block}#klocalstorage_trigger{position:fixed;z-index:100000;top:0;right:0;width:25px;height:25px;line-height:25px;text-align:center;font-family:monospace;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;user-select:none}#klocalstorage_trigger.active{background-color:#fff}#klocalstorage *{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#klocalstorage{display:none;position:fixed;z-index:99999;top:0;right:0;width:600px;height:100%;background-color:#fff;font-family:monospace;white-space:pre;font-size:13px;line-height:1.5;overflow:scroll;box-shadow:0 0 15px #555}#klocalstorage.active{display:block}#klocalstorage h5{position:relative;padding:10px;height:40px;line-height:20px;-webkit-user-select:none;-moz-user-select:none;user-select:none}#klocalstorage h5+div{padding:0 10px;display:none;margin-bottom:10px}#klocalstorage h5+div.active{display:block}#klocalstorage h5:hover,#klocalstorage h5.active{background-color:#eee;cursor:pointer}#klocalstorage h5.active{border-left:5px solid #ddd}#klocalstorage h5.active button{display:block}#klocalstorage h5 button{position:absolute;display:none;top:9px;width:60px;height:23px;font-size:11px;cursor:default;text-align:center}#klocalstorage h5 button[action="save"],#klocalstorage h5 button[action="restore"]{right:15px}#klocalstorage h5 button[action="delete"]{right:75px}#klocalstorage h5 .klocalstorage_msg{position:absolute;top:12px;right:145px}#klocalstorage textarea.text{min-height:100%;line-height:1.5}#klocalstorage .jsoneditor,#klocalstorage .outer{height:auto;min-height:150px}#klocalstorage .outer{resize:vertical}</style>';var o='<div id ="klocalstorage_trigger">+</div>';var t='<div id ="klocalstorage"></div>';var a='<div id ="klocalstorage_overlay"></div>';$("head").append(e);$("body").append(o,t,a);klocalstorage.getLatest();klocalstorage.attachMarkupHandlers();$("#klocalstorage_overlay").click(function(){$("#klocalstorage_trigger, #klocalstorage, #klocalstorage_overlay").toggleClass("active");$("body").toggleClass("klocalstorage_activated");if(!$("#klocalstorage_trigger").hasClass("active")){$("#klocalstorage_trigger").html("+")}});$("#klocalstorage_trigger").click(function(){$(this).toggleClass("active");$("body").toggleClass("klocalstorage_activated");if($(this).hasClass("active")){$(this).html("-");klocalstorage.getLatest();klocalstorage.attachMarkupHandlers()}else{$(this).html("+")}$("#klocalstorage, #klocalstorage_overlay").toggleClass("active")})};klocalstorage.getLatest=function(){var e="";var o={};var t={};var a=localStorage.length;var l,r,s,i;var c={mode:"tree",modes:["tree","text"]};for(l=0;l<a;l++){e+='<h5 data-index="'+l+'">'+localStorage.key(l)+'<button action="delete">Delete</button><button action="save">Save</button></h5>';e+='<div data-index="'+l+'"></div>'}e+='<h5 data-index="'+(l+1)+'">// Other items</h5>';e+='<div data-index="'+(l+1)+'"></div>';e+='<h5 data-index="'+(l+2)+'">// Raw localStorage</h5>';e+='<div data-index="'+(l+2)+'"></div>';$("#klocalstorage").html(e);for(l=0;l<a;l++){r="";s=localStorage.key(l);i=localStorage.getItem(s);klocalstorage.editor["_"+l]=new JSONEditor($('#klocalstorage div[data-index="'+l+'"]')[0],c);try{r=JSON.parse(i)}catch(n){r=i}if(typeof r!=="object"){o[s]=r;$('#klocalstorage div[data-index="'+l+'"], #klocalstorage h5[data-index="'+l+'"]').remove()}else{klocalstorage.editor["_"+l].set(r)}t[s]=r}klocalstorage.editor["_"+(l+1)]=new JSONEditor($('#klocalstorage div[data-index="'+(l+1)+'"]')[0],c);klocalstorage.editor["_"+(l+2)]=new JSONEditor($('#klocalstorage div[data-index="'+(l+2)+'"]')[0],c);klocalstorage.editor["_"+(l+1)].set(o);klocalstorage.editor["_"+(l+2)].set(t)};klocalstorage.attachMarkupHandlers=function(){var e=function(e){var o=$(this).parent().data("index");var t=localStorage.key(o);var a;e.stopImmediatePropagation();try{a=klocalstorage.editor["_"+o].get();localStorage.setItem(t,JSON.stringify(a));$(this).before('<span class="klocalstorage_msg">Saved!</span>');$("#klocalstorage h5 .klocalstorage_msg").fadeOut(1e3,function(){$(this).remove()})}catch(l){$(this).before('<span class="klocalstorage_msg">Error! Must be String, Number, Array or Object!</span>');$("#klocalstorage h5 .klocalstorage_msg").fadeOut(5e3,function(){$(this).remove()})}};var o=function(o){var t=$(this).parent().data("index");var a=klocalstorage.editor["_"+t].get();var l=localStorage.key(t);o.stopImmediatePropagation();localStorage.removeItem(l);$(this).prop("disabled",true).siblings('button[action="save"]').off("click").html("Restore").attr("action","restore").on("click",function(o){o.stopImmediatePropagation();localStorage.setItem(l,JSON.stringify(a));$(this).attr("action","save").html("Save").off("click").on("click",e).before('<span class="klocalstorage_msg">Restored!</span>').siblings('button[action="delete"]').prop("disabled",false);$("#klocalstorage h5 .klocalstorage_msg").fadeOut(1e3,function(){$(this).remove()})});$(this).before('<span class="klocalstorage_msg">Deleted!</span>');$("#klocalstorage h5 .klocalstorage_msg").fadeOut(1e3,function(){$(this).remove()})};$("#klocalstorage h5").off("click").on("click",function(){$(this).toggleClass("active").next("div").toggleClass("active")});$('#klocalstorage h5 button[action="save"]').off("click").on("click",e);$('#klocalstorage h5 button[action="delete"]').off("click").on("click",o)};klocalstorage.corsRequest=function(e,o,t,a,l){var r;if(XMLHttpRequest){r=new XMLHttpRequest;if("withCredentials"in r){r.open(o,e,true);r.onerror=l;r.onreadystatechange=function(){if(r.readyState===4){if(r.status>=200&&r.status<400){a(r.responseText)}else{l()}}};r.send(t)}}else if(XDomainRequest){r=new XDomainRequest;r.open(o,e);r.onerror=l;r.onload=function(){a(r.responseText)};r.send(t)}else{l()}};klocalstorage.appendScript=function(e,o,t){t=e.createElement("script");t.async=1;t.innerHTML=o;klocalstorage.SCRIPT.parentNode.insertBefore(t,klocalstorage.SCRIPT)};klocalstorage.appendStyle=function(e,o){o=e.createElement("link");o.rel="stylesheet";o.href=klocalstorage.JSONEDITOR_STYLE_URL;klocalstorage.STYLE.parentNode.insertBefore(o,klocalstorage.STYLE)};klocalstorage.build=function(){if(typeof jQuery==="undefined"&&typeof JSONEditor==="undefined"){klocalstorage.corsRequest(klocalstorage.JQUERY_URL,"GET","",function(e){klocalstorage.appendScript(document,e);klocalstorage.corsRequest(klocalstorage.JSONEDITOR_URL,"GET","",function(e){klocalstorage.appendScript(document,e);klocalstorage.corsRequest(klocalstorage.JSONEDITOR_STYLE_URL,"GET","",function(e){klocalstorage.appendStyle(document,e);klocalstorage.init()},function(){console.error(klocalstorage.ERROR_MSG)})},function(){console.error(klocalstorage.ERROR_MSG)})},function(){console.error(klocalstorage.ERROR_MSG)})}if(typeof jQuery==="undefined"&&typeof JSONEditor!=="undefined"){klocalstorage.corsRequest(klocalstorage.JQUERY_URL,"GET","",function(e){klocalstorage.appendScript(document,e);klocalstorage.init()},function(){console.error(klocalstorage.ERROR_MSG)})}if(typeof jQuery!=="undefined"&&typeof JSONEditor==="undefined"){klocalstorage.corsRequest(klocalstorage.JSONEDITOR_URL,"GET","",function(e){klocalstorage.appendScript(document,e);klocalstorage.corsRequest(klocalstorage.JSONEDITOR_STYLE_URL,"GET","",function(e){klocalstorage.appendStyle(document,e);klocalstorage.init()},function(){console.error(klocalstorage.ERROR_MSG)})},function(){console.error(klocalstorage.ERROR_MSG)})}if(typeof jQuery!=="undefined"&&typeof JSONEditor!=="undefined"){klocalstorage.init()}}();

/*
**
**  klocalstorage
**  =============
**
**  Version 1.0.0
**
**  Brought to you by
**  https://www.kycosoftware.com
**
**  Copyright 2015 Cornelius Weidmann
**
**  Distributed under the GPL
**
*/

"use strict";var klocalstorage={}||klocalstorage;klocalstorage.JQUERY_URL="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js";klocalstorage.JSONEDITOR_URL="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/4.2.1/jsoneditor.min.js";klocalstorage.JSONEDITOR_STYLE_URL="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/4.2.1/jsoneditor.min.css";klocalstorage.STYLE=document.getElementById("klocalstorage_style");klocalstorage.SCRIPT=document.getElementById("klocalstorage_script");klocalstorage.ERROR_MSG="An error occurred while getting the required dependencies.";klocalstorage.editor={};klocalstorage.init=function(){var e='<div id="klocalstorage_trigger">+</div>';var o='<div id="klocalstorage_options">â€¦</div>';var t='<div id="klocalstorage"></div>';var a='<div id="klocalstorage_overlay"></div>';$("body").append(e,o,t,a);klocalstorage.getLatest();klocalstorage.attachMarkupHandlers();$("#klocalstorage_overlay").click(function(){$("#klocalstorage_trigger, #klocalstorage_options, #klocalstorage, #klocalstorage_overlay").toggleClass("active");$("body").toggleClass("klocalstorage_activated");if(!$("#klocalstorage_trigger").hasClass("active")){$("#klocalstorage_trigger").html("+")}});$("#klocalstorage_trigger").click(function(){$(this).toggleClass("active");$("body").toggleClass("klocalstorage_activated");if($(this).hasClass("active")){$(this).html("-");klocalstorage.getLatest();klocalstorage.attachMarkupHandlers()}else{$(this).html("+")}$("#klocalstorage_options, #klocalstorage, #klocalstorage_overlay").toggleClass("active")})};klocalstorage.getLatest=function(){var e="";var o={};var t={};var a=localStorage.length;var l,r,s,c;var i={mode:"tree",modes:["tree","text"]};for(l=0;l<a;l++){e+='<h5 data-index="'+l+'">'+localStorage.key(l)+"<button>Save</button></h5>";e+='<div data-index="'+l+'"></div>'}e+='<h5 data-index="'+(l+1)+'">// Other items</h5>';e+='<div data-index="'+(l+1)+'"></div>';e+='<h5 data-index="'+(l+2)+'">// Raw localStorage</h5>';e+='<div data-index="'+(l+2)+'"></div>';$("#klocalstorage").html(e);for(l=0;l<a;l++){r="";s=localStorage.key(l);c=localStorage.getItem(s);klocalstorage.editor["_"+l]=new JSONEditor($('#klocalstorage div[data-index="'+l+'"]')[0],i);try{r=JSON.parse(c)}catch(n){r=c}if(typeof r!=="object"){o[s]=r;$('#klocalstorage div[data-index="'+l+'"], #klocalstorage h5[data-index="'+l+'"]').remove()}else{klocalstorage.editor["_"+l].set(r)}t[s]=r}klocalstorage.editor["_"+(l+1)]=new JSONEditor($('#klocalstorage div[data-index="'+(l+1)+'"]')[0],i);klocalstorage.editor["_"+(l+2)]=new JSONEditor($('#klocalstorage div[data-index="'+(l+2)+'"]')[0],i);klocalstorage.editor["_"+(l+1)].set(o);klocalstorage.editor["_"+(l+2)].set(t)};klocalstorage.attachMarkupHandlers=function(){$("#klocalstorage h5").off("click").on("click",function(){$(this).toggleClass("active").next("div").toggleClass("active")});$("#klocalstorage h5 button").off("click").on("click",function(e){var o=$(this).parent().data("index");var t=klocalstorage.editor["_"+o].get();var a=localStorage.key(o);e.stopImmediatePropagation();localStorage.setItem(a,JSON.stringify(t));$(this).before('<span class="icon-select-selected"></span>');$("#klocalstorage h5 .icon-select-selected").fadeOut(1e3,function(){$(this).remove()})})};klocalstorage.corsRequest=function(e,o,t,a,l){var r;if(XMLHttpRequest){r=new XMLHttpRequest;if("withCredentials"in r){r.open(o,e,true);r.onerror=l;r.onreadystatechange=function(){if(r.readyState===4){if(r.status>=200&&r.status<400){a(r.responseText)}else{l()}}};r.send(t)}}else if(XDomainRequest){r=new XDomainRequest;r.open(o,e);r.onerror=l;r.onload=function(){a(r.responseText)};r.send(t)}else{l()}};klocalstorage.appendScript=function(e,o,t){t=e.createElement("script");t.async=1;t.innerHTML=o;klocalstorage.SCRIPT.parentNode.insertBefore(t,klocalstorage.SCRIPT)};klocalstorage.appendStyle=function(e,o){o=e.createElement("link");o.rel="stylesheet";o.href=klocalstorage.JSONEDITOR_STYLE_URL;klocalstorage.STYLE.parentNode.insertBefore(o,klocalstorage.STYLE)};klocalstorage.build=function(){if(typeof jQuery==="undefined"&&typeof JSONEditor==="undefined"){klocalstorage.corsRequest(klocalstorage.JQUERY_URL,"GET","",function(e){klocalstorage.appendScript(document,e);klocalstorage.corsRequest(klocalstorage.JSONEDITOR_URL,"GET","",function(e){klocalstorage.appendScript(document,e);klocalstorage.corsRequest(klocalstorage.JSONEDITOR_STYLE_URL,"GET","",function(e){klocalstorage.appendStyle(document,e);klocalstorage.init()},function(){console.error(klocalstorage.ERROR_MSG)})},function(){console.error(klocalstorage.ERROR_MSG)})},function(){console.error(klocalstorage.ERROR_MSG)})}if(typeof jQuery==="undefined"&&typeof JSONEditor!=="undefined"){klocalstorage.corsRequest(klocalstorage.JQUERY_URL,"GET","",function(e){klocalstorage.appendScript(document,e);klocalstorage.init()},function(){console.error(klocalstorage.ERROR_MSG)})}if(typeof jQuery!=="undefined"&&typeof JSONEditor==="undefined"){klocalstorage.corsRequest(klocalstorage.JSONEDITOR_URL,"GET","",function(e){klocalstorage.appendScript(document,e);klocalstorage.corsRequest(klocalstorage.JSONEDITOR_STYLE_URL,"GET","",function(e){klocalstorage.appendStyle(document,e);klocalstorage.init()},function(){console.error(klocalstorage.ERROR_MSG)})},function(){console.error(klocalstorage.ERROR_MSG)})}if(typeof jQuery!=="undefined"&&typeof JSONEditor!=="undefined"){klocalstorage.init()}}();
